<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>–ü—Ä–æ–≥—Ä–µ—Å—Å ‚Äî Morphe</title>

  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon-32.png">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f97316">

  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/styles-shared.css">
  <link rel="stylesheet" href="/styles-header.css">
</head>
<body>

  <div id="header-placeholder"></div>

  <main id="main-content" tabindex="-1">
    <div class="container">
      <h1>üìà –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h1>
      <p>–§–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî –≤–∏–¥—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>

      <!-- üß† –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ -->
      <section class="card" id="aiInsightSection" style="display: none;">
        <h2>üß† –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h2>
        <div id="aiInsightContent">
          <p id="aiInsightText">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏–∑–∞...</p>
        </div>
      </section>

      <!-- üìä –ü—Ä–æ–≥–Ω–æ–∑ –∏ —Ç—Ä–µ–Ω–¥—ã -->
      <section class="card" id="forecastSection" style="display: none;">
        <h2>üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –∏ –¥–∏–Ω–∞–º–∏–∫–∞</h2>
        <div class="stats-grid-2">
          <div class="stat-card">
            <h3>–í–µ—Å</h3>
            <p id="weightTrend">‚Äî</p>
          </div>
          <div class="stat-card">
            <h3>–ü—Ä–æ–≥–Ω–æ–∑</h3>
            <p id="weightForecast">‚Äî</p>
          </div>
        </div>
      </section>

      <!-- –§–æ—Ä–º–∞ –∑–∞–º–µ—Ä–æ–≤ -->
      <form id="progressForm" class="card minimalist-card" novalidate>
        <div class="form-grid-2x4">
          <div class="input-icon">
            <span>‚öñÔ∏è</span>
            <input type="number" id="weight" name="weight" step="0.1" min="40" max="200" required placeholder="–í–µ—Å, –∫–≥" class="form-control-compact">
          </div>
          <div class="input-icon">
            <span>ü´Å</span>
            <input type="number" id="chest" name="chest" step="0.5" placeholder="–ì—Ä—É–¥—å, —Å–º" class="form-control-compact">
          </div>
          <div class="input-icon">
            <span>üåÄ</span>
            <input type="number" id="waist" name="waist" step="0.5" placeholder="–¢–∞–ª–∏—è, —Å–º" class="form-control-compact">
          </div>
          <div class="input-icon">
            <span>ü¶µ</span>
            <input type="number" id="thighLeft" name="thighLeft" step="0.5" placeholder="–ë–µ–¥—Ä–æ –õ, —Å–º" class="form-control-compact">
          </div>
          <div class="input-icon">
            <span>ü¶µ</span>
            <input type="number" id="thighRight" name="thighRight" step="0.5" placeholder="–ë–µ–¥—Ä–æ –ü, —Å–º" class="form-control-compact">
          </div>
          <div class="input-icon">
            <span>üí™</span>
            <input type="number" id="bicepLeft" name="bicepLeft" step="0.5" placeholder="–ë–∏—Ü–µ–ø—Å –õ, —Å–º" class="form-control-compact">
          </div>
          <div class="input-icon">
            <span>üí™</span>
            <input type="number" id="bicepRight" name="bicepRight" step="0.5" placeholder="–ë–∏—Ü–µ–ø—Å –ü, —Å–º" class="form-control-compact">
          </div>
          <div class="input-icon full-width">
            <span>üìù</span>
            <textarea id="notes" name="notes" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="1" class="form-control-compact"></textarea>
          </div>
        </div>
        <button type="submit" class="btn-orange">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí</button>
      </form>

      <div id="formFeedback" aria-live="polite"></div>

      <!-- üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
      <section class="card progress-calendar">
        <h2>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</h2>
        
        <div class="calendar-controls">
          <button id="prevMonth">&larr; –ü—Ä–µ–¥.</button>
          <span id="currentMonthTitle">–ò—é–Ω—å 2024</span>
          <button id="nextMonth">–°–ª–µ–¥. &rarr;</button>
        </div>
        
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color body-color"></div>
            <span>üü¢ –ó–∞–º–µ—Ä —Ç–µ–ª–∞</span>
          </div>
          <div class="legend-item">
            <div class="legend-color nutrition-color"></div>
            <span>üü° –ü–∏—Ç–∞–Ω–∏–µ</span>
          </div>
          <div class="legend-item">
            <div class="legend-color workout-color"></div>
            <span>üîµ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
          </div>
          <div class="legend-item">
            <div class="legend-color supplement-color"></div>
            <span>üíä –í–∏—Ç–∞–º–∏–Ω—ã</span>
          </div>
          <div class="legend-item">
            <div class="legend-color multiple-color"></div>
            <span>üü£ –ù–µ—Å–∫–æ–ª—å–∫–æ</span>
          </div>
        </div>
        
        <div class="calendar-header">
          <div>–ü–Ω</div><div>–í—Ç</div><div>–°—Ä</div><div>–ß—Ç</div><div>–ü—Ç</div><div>–°–±</div><div>–í—Å</div>
        </div>
        <div class="calendar-grid" id="progressCalendar"></div>
      </section>
    </div>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
  <div id="dayModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="modalDateTitle">–î–µ—Ç–∞–ª–∏ –∑–∞ ‚Äî</h2>
      
      <div id="modalBodySection" style="display: none;">
        <h3>üìè –ó–∞–º–µ—Ä—ã —Ç–µ–ª–∞</h3>
        <div id="modalBodyItems"></div>
      </div>
      
      <div id="modalNutritionSection" style="display: none;">
        <h3>ü•ó –ü–∏—Ç–∞–Ω–∏–µ</h3>
        <div id="modalNutritionItems"></div>
      </div>
      
      <div id="modalWorkoutSection" style="display: none;">
        <h3>üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h3>
        <div id="modalWorkoutItems"></div>
      </div>
      
      <div id="modalSupplementSection" style="display: none;">
        <h3>üíä –î–æ–±–∞–≤–∫–∏</h3>
        <div id="modalSupplementItems"></div>
      </div>
    </div>
  </div>

  <div id="footer-placeholder"></div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js');
      });
    }
  </script>

<script type="module">
  import { HeaderController } from '/core/HeaderController.js';
  import { ThemeManager } from '/core/themeManager.js';
  import { ProgressTracker } from '/modules/progressTracker.js';
  import { ProgressCalendar } from '/modules/progressCalendar.js';
  import { AIAssistant } from '/modules/aiAssistant.js';
  import { AnalyticsEngine } from '/core/analytics.js';
  import { UserService } from '/services/userService.js';

  document.addEventListener('DOMContentLoaded', async () => {
    try {
      await HeaderController.loadHeader();
      await HeaderController.loadFooter();
      new ThemeManager();

      const aiInsightSection = document.getElementById('aiInsightSection');
      const aiInsightText = document.getElementById('aiInsightText');
      const forecastSection = document.getElementById('forecastSection');
      const weightTrendEl = document.getElementById('weightTrend');
      const weightForecastEl = document.getElementById('weightForecast');
      const form = document.getElementById('progressForm');
      const feedback = document.getElementById('formFeedback');

      // === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ===
      const modal = document.getElementById('dayModal');
      const closeBtn = document.querySelector('.close');

      closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
      });

      window.addEventListener('click', (e) => {
        if (e.target === modal) modal.style.display = 'none';
      });

      async function showDayModal(dateStr) {
        const calendar = new ProgressCalendar();
        const details = await calendar.getDayDetails(dateStr);
        
        const title = document.getElementById('modalDateTitle');
        const date = new Date(dateStr).toLocaleDateString('ru-RU', {
          weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
        title.textContent = `–î–µ—Ç–∞–ª–∏ –∑–∞ ${date}`;
        
        // –ó–∞–º–µ—Ä—ã —Ç–µ–ª–∞
        const bodySection = document.getElementById('modalBodySection');
        const bodyItems = document.getElementById('modalBodyItems');
        if (details.body.length > 0) {
          const lastEntry = details.body[details.body.length - 1];
          bodyItems.innerHTML = `
            <p>–í–µ—Å: ${lastEntry.weight} –∫–≥
            ${lastEntry.chest ? ` | –ì—Ä—É–¥—å: ${lastEntry.chest} —Å–º` : ''}
            ${lastEntry.waist ? ` | –¢–∞–ª–∏—è: ${lastEntry.waist} —Å–º` : ''}
            ${lastEntry.bicepLeft || lastEntry.bicepRight ? 
              ` | –ë–∏—Ü–µ–ø—Å: –õ ${lastEntry.bicepLeft || '‚Äî'} / –ü ${lastEntry.bicepRight || '‚Äî'} —Å–º` : ''}
            ${lastEntry.thighLeft || lastEntry.thighRight ? 
              ` | –ë–µ–¥—Ä–æ: –õ ${lastEntry.thighLeft || '‚Äî'} / –ü ${lastEntry.thighRight || '‚Äî'} —Å–º` : ''}
            ${lastEntry.notes ? `<br><small>üí¨ ${lastEntry.notes}</small>` : ''}
            </p>
          `;
          bodySection.style.display = 'block';
        } else {
          bodySection.style.display = 'none';
        }
        
        // –ü–∏—Ç–∞–Ω–∏–µ
        const nutritionSection = document.getElementById('modalNutritionSection');
        const nutritionItems = document.getElementById('modalNutritionItems');
        if (details.nutrition.length > 0) {
          nutritionSection.style.display = 'block';
          nutritionItems.innerHTML = details.nutrition.map(item => `
            <p>${item.name} (${item.grams}–≥) ‚Äî ${Math.round(item.calories * item.grams / 100)} –∫–∫–∞–ª</p>
          `).join('');
        } else {
          nutritionSection.style.display = 'none';
        }
        
        // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        const workoutSection = document.getElementById('modalWorkoutSection');
        const workoutItems = document.getElementById('modalWorkoutItems');
        if (details.workouts.length > 0) {
          workoutSection.style.display = 'block';
          workoutItems.innerHTML = details.workouts.map(w => {
            const exercisesList = w.exercises && w.exercises.length > 0
              ? `<ul>${w.exercises.map(ex => 
                  `<li>${ex.name || '–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ'}: ${ex.sets?.length || 0} –ø–æ–¥—Ö–æ–¥–æ–≤</li>`
                ).join('')}</ul>`
              : '<p>–ù–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>';
            return `<div class="workout-item"><strong>${w.name || '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞'}</strong>${exercisesList}</div>`;
          }).join('');
        } else {
          workoutSection.style.display = 'none';
        }
        
        // –î–æ–±–∞–≤–∫–∏
        const supplementSection = document.getElementById('modalSupplementSection');
        const supplementItems = document.getElementById('modalSupplementItems');
        if (details.supplements && details.supplements.length > 0) {
          supplementSection.style.display = 'block';
          supplementItems.innerHTML = details.supplements.map(s => `
            <p>üíä ${s.name || '–î–æ–±–∞–≤–∫–∞'}${s.dose ? ` ‚Äî ${s.dose}` : ''}</p>
          `).join('');
        } else {
          supplementSection.style.display = 'none';
        }
        
        modal.style.display = 'block';
      }

      // === –ö–ê–õ–ï–ù–î–ê–†–¨ –ù–ê –ú–ï–°–Ø–¶ ===
      let currentMonth = new Date();

      async function renderCalendarForMonth(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        
        const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
          '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
        document.getElementById('currentMonthTitle').textContent = `${monthNames[month]} ${year}`;
        
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startDayOfWeek = firstDay.getDay();
        
        const calendarEl = document.getElementById('progressCalendar');
        calendarEl.innerHTML = '';
        
        for (let i = 0; i < startDayOfWeek; i++) {
          const empty = document.createElement('div');
          empty.className = 'calendar-day empty';
          calendarEl.appendChild(empty);
        }
        
        const calendar = new ProgressCalendar();
        const today = new Date().toISOString().split('T')[0];
        
        for (let day = 1; day <= daysInMonth; day++) {
          const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          const dayEl = document.createElement('div');
          dayEl.className = 'calendar-day';
          dayEl.textContent = day;
          dayEl.dataset.date = dateStr;
          
          if (dateStr === today) {
            dayEl.classList.add('today');
          }
          
          const details = await calendar.getDayDetails(dateStr);
          const types = [];
          if (details.body.length > 0) types.push('body');
          if (details.nutrition.length > 0) types.push('nutrition');
          if (details.workouts.length > 0) types.push('workout');
          if (details.supplements && details.supplements.length > 0) types.push('supplement');
          
          if (types.length === 1) {
            dayEl.classList.add(`has-${types[0]}`);
          } else if (types.length > 1) {
            dayEl.classList.add('has-multiple');
          }
          
          dayEl.addEventListener('click', () => showDayModal(dateStr));
          calendarEl.appendChild(dayEl);
        }
      }

      // === –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó ===
      try {
        const ai = new AIAssistant();
        const aiAdvice = await ai.generateAdvice();
        aiInsightText.innerHTML = `
          ${aiAdvice.emoji ? aiAdvice.emoji + ' ' : ''}<strong>${aiAdvice.title}</strong><br>
          ${aiAdvice.message}
        `;
        aiInsightSection.style.display = 'block';
      } catch (err) {
        console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–Ω–∞–ª–∏–∑:', err);
      }

      // === –ü–†–û–ì–ù–û–ó –ò –¢–†–ï–ù–î–´ ===
      try {
        const profile = UserService.getProfile()?.data;
        const analytics = new AnalyticsEngine(profile);
        const progressInsight = await analytics._getProgressInsight();
        
        weightTrendEl.textContent = progressInsight.text || '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö';
        
        const tracker = new ProgressTracker();
        const recent = tracker.getSince(21);
        if (recent.length >= 2 && profile && profile.targetWeight) {
          const first = recent[recent.length - 1];
          const last = recent[0];
          const weeks = Math.max(1, (new Date(last.date) - new Date(first.date)) / (7 * 24 * 60 * 60 * 1000));
          const changePerWeek = (last.weight - first.weight) / weeks;
          
          if (Math.abs(changePerWeek) > 0.1) {
            const diff = Math.abs(profile.targetWeight - last.weight);
            const weeksToGoal = diff / Math.abs(changePerWeek);
            weightForecastEl.textContent = `–¶–µ–ª—å –∑–∞ ~${Math.ceil(weeksToGoal)} –Ω–µ–¥–µ–ª—å`;
          } else {
            weightForecastEl.textContent = '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å';
          }
        } else {
          weightForecastEl.textContent = '–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö';
        }
        
        forecastSection.style.display = 'block';
      } catch (err) {
        console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑:', err);
      }

      // === –°–û–•–†–ê–ù–ï–ù–ò–ï –ó–ê–ú–ï–†–û–í ===
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const weight = parseFloat(formData.get('weight'));
        if (isNaN(weight) || weight < 40 || weight > 200) {
          feedback.innerHTML = '<p class="error-text">‚ùå –£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å (40‚Äì200 –∫–≥)</p>';
          return;
        }

        const hasAnyMeasurement = 
          formData.get('chest') || formData.get('waist') || 
          formData.get('thighLeft') || formData.get('thighRight') || 
          formData.get('bicepLeft') || formData.get('bicepRight');

        if (!hasAnyMeasurement) {
          feedback.innerHTML = '<p class="error-text">‚ùå –£–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–∞–º–µ—Ä —Ç–µ–ª–∞</p>';
          return;
        }

        try {
          const tracker = new ProgressTracker();
          tracker.add({
            weight: weight,
            chest: formData.get('chest') ? parseFloat(formData.get('chest')) : null,
            waist: formData.get('waist') ? parseFloat(formData.get('waist')) : null,
            thighLeft: formData.get('thighLeft') ? parseFloat(formData.get('thighLeft')) : null,
            thighRight: formData.get('thighRight') ? parseFloat(formData.get('thighRight')) : null,
            bicepLeft: formData.get('bicepLeft') ? parseFloat(formData.get('bicepLeft')) : null,
            bicepRight: formData.get('bicepRight') ? parseFloat(formData.get('bicepRight')) : null,
            notes: formData.get('notes')
          });

          feedback.innerHTML = '<p class="success-text">‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!</p>';
          form.reset();

          renderCalendarForMonth(currentMonth);

          setTimeout(() => { feedback.innerHTML = ''; }, 2000);
        } catch (err) {
          feedback.innerHTML = `<p class="error-text">‚ùå –û—à–∏–±–∫–∞: ${err.message}</p>`;
        }
      });

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      renderCalendarForMonth(currentMonth);

    } catch (err) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', err);
      const feedback = document.getElementById('formFeedback');
      if (feedback) {
        feedback.innerHTML = `<p class="error-text">‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ${err.message}</p>`;
      }
    }
  });
</script>

<style>
  /* === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û === */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
  }

  .modal-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 20px;
    border-radius: 16px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close:hover { color: #000; }

  /* === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–õ–ï–ù–î–ê–†–Å–ú === */
  .calendar-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }
  .calendar-controls button {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    padding: 6px 12px;
    border-radius: 8px;
    cursor: pointer;
  }

  /* === –ù–û–í–´–ï –°–¢–ò–õ–ò === */
  .stats-grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 16px 0;
  }

  .stat-card h3 {
    font-size: 1rem;
    margin-bottom: 8px;
    color: var(--text-primary);
  }

  .stat-card p {
    font-size: 0.95rem;
    line-height: 1.5;
  }

  /* === –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –°–¢–ò–õ–ò === */
  .minimalist-card {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    border-radius: 16px;
    padding: 20px;
  }

  .orange-title {
    color: #f97316;
    font-weight: 800;
    font-size: 1.5rem;
  }

  .form-grid-2x4 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  @media (min-width: 768px) {
    .form-grid-2x4 {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  .input-icon {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #fafafa;
    border-radius: 12px;
    padding: 8px 12px;
    transition: background 0.3s ease;
  }

  .input-icon:hover {
    background: #f4f4f5;
  }

  .input-icon span {
    font-size: 1.1rem;
    opacity: 0.8;
  }

  .form-control-compact {
    background: transparent;
    border: none;
    color: #111827;
    font-size: 0.95rem;
    width: 100%;
    padding: 4px 0;
    outline: none;
  }

  .form-control-compact::placeholder {
    color: #6b7280;
    opacity: 0.7;
  }

  .full-width {
    grid-column: 1 / -1;
  }

  .btn-orange {
    width: 100%;
    padding: 12px;
    background: #f97316;
    color: white;
    border: none;
    border-radius: 14px;
    font-weight: 600;
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-orange:hover {
    background: #ea580c;
    transform: translateY(-2px);
  }

  /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
  .progress-calendar { margin: 32px 0; }
  .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin: 16px 0; }
  .calendar-day { 
    aspect-ratio: 1; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: 0.8rem; 
    border-radius: 8px; 
    background: var(--bg-surface); 
    position: relative; 
    cursor: pointer; 
    transition: transform 0.2s, box-shadow 0.2s; 
    border: 1px solid var(--border); 
  }
  .calendar-day.empty { 
    background: transparent; 
    border: none; 
    cursor: default; 
  }
  .calendar-day:hover:not(.empty) { 
    transform: scale(1.05); 
    box-shadow: 0 4px 8px var(--shadow); 
  }
  .calendar-day.has-body { background: var(--success); color: white; }
  .calendar-day.has-nutrition { background: var(--warning); color: white; }
  .calendar-day.has-workout { background: var(--accent); color: white; }
  .calendar-day.has-supplement { background: #8b5cf6; color: white; }
  .calendar-day.has-multiple { background: var(--text-tertiary); color: white; }
  .calendar-day.today { border: 2px solid var(--accent); }
  .calendar-header { 
    display: grid; 
    grid-template-columns: repeat(7, 1fr); 
    text-align: center; 
    font-weight: bold; 
    font-size: 0.8rem; 
    margin-bottom: 8px; 
    color: var(--text-secondary); 
  }
  .legend { 
    display: flex; 
    gap: 16px; 
    margin: 16px 0; 
    flex-wrap: wrap; 
  }
  .legend-item { 
    display: flex; 
    align-items: center; 
    gap: 6px; 
    font-size: 0.9rem; 
  }
  .legend-color { 
    width: 16px; 
    height: 16px; 
    border-radius: 4px; 
  }
  .body-color { background: var(--success); }
  .nutrition-color { background: var(--warning); }
  .workout-color { background: var(--accent); }
  .supplement-color { background: #8b5cf6; }
  .multiple-color { background: var(--text-tertiary); }

  @media (max-width: 768px) {
    .calendar-grid { gap: 2px; }
    .calendar-day { font-size: 0.75rem; min-height: 36px; }
    .legend { flex-direction: column; gap: 8px; }
  }
</style>
</body>
</html>