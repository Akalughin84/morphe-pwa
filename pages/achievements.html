<!-- /pages/achievements.html -->
<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è ‚Äî Morphe</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon-32.png">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <link rel="manifest" href="/manifest.json">

  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/styles-shared.css">
  <link rel="stylesheet" href="/styles-form.css">

  <!-- Skip-link -->
  <style>
    .skip-link {
      position: absolute;
      top: -40px;
      left: 10px;
      background: #000;
      color: #fff;
      padding: 8px;
      text-decoration: none;
      z-index: 1000;
      transition: top 0.3s ease;
    }
    .skip-link:focus { top: 10px; }
  </style>
</head>
<body>

  

  <!-- –ó–∞–≥–ª—É—à–∫–∞ —à–∞–ø–∫–∏ -->
  <div id="header-placeholder"></div>

  <main id="main-content">
    <div class="container">
      <section class="card">
        <h1>üèÜ –í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h1>
        <p id="achievementsStats">–ó–∞–≥—Ä—É–∑–∫–∞...</p>

        <div id="achievementsGrid" style="display: none;">
          <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JS -->
        </div>

        <div id="noAchievements" style="display: none;">
          <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–≤–æ–π –ø—É—Ç—å ‚Äî –æ–Ω–∏ –ø–æ—è–≤—è—Ç—Å—è!</p>
        </div>
      </section>
    </div>
  </main>

  <!-- –ó–∞–≥–ª—É—à–∫–∞ –ø–æ–¥–≤–∞–ª–∞ -->
  <div id="footer-placeholder"></div>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js');
      });
    }
  </script>

  <!-- –õ–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <script type="module">
    import { HeaderController } from '/core/HeaderController.js';
    import { ThemeManager } from '/core/themeManager.js';
    import { AchievementsManager } from '/modules/achievementsManager.js';
    import { AchievementEngine } from '/core/achievementEngine.js';

    document.addEventListener('DOMContentLoaded', async () => {
      await HeaderController.loadHeader();
      new ThemeManager();

      const statsEl = document.getElementById('achievementsStats');
      const gridEl = document.getElementById('achievementsGrid');
      const noEl = document.getElementById('noAchievements');

      try {
        const manager = new AchievementsManager();
        const engine = new AchievementEngine();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        await engine.checkAll();

        const achievements = manager.getAllWithStatus();
        const unlockedCount = manager.getUnlockedCount();

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        statsEl.innerHTML = `
          <strong>${unlockedCount}</strong> –∏–∑ ${achievements.length} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–ª—É—á–µ–Ω–æ
        `;

        if (unlockedCount === 0) {
          noEl.style.display = 'block';
          return;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
        gridEl.innerHTML = achievements.map(a => {
          const isUnlocked = a.unlocked;
          return `
            <div class="achievement-card ${isUnlocked ? 'unlocked' : 'locked'}">
              <div class="achievement-icon">
                ${isUnlocked ? a.icon : 'üîí'}
              </div>
              <h3>${a.title}</h3>
              <p>${a.description}</p>
              ${a.secret ? `<small><em>–°–µ–∫—Ä–µ—Ç–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ</em></small>` : ''}
              ${a.type === 'streak' && a.progress !== null ? 
                `<progress value="${a.progress}" max="${a.target}"></progress>
                 <small>${a.progress}/${a.target}</small>` : ''
              }
            </div>
          `;
        }).join('');

        gridEl.style.display = 'block';

      } catch (err) {
        statsEl.textContent = `–û—à–∏–±–∫–∞: ${err.message}`;
        statsEl.className = 'error-text';
        console.error(err);
      }
    });

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–≤–∞–ª–∞
    document.addEventListener('DOMContentLoaded', async () => {
      await import('/core/HeaderController.js').then(m => m.HeaderController.loadFooter());
    });
  </script>
</body>
</html>