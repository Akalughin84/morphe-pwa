<!-- pages/profile.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Morphe ‚Äî –ù–∞—Å—Ç—Ä–æ–π –ø—Ä–æ—Ñ–∏–ª—å</title>
  <link rel="stylesheet" href="../styles.css" />
</head>
<body>
  <header class="page-header">
    <div class="container">
      <a href="../index.html" class="logo-link">
        <div class="logo">Morphe</div>
      </a>
      <nav class="page-nav">
        <a href="../index.html" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      </nav>
    </div>
  </header>

  <main class="form-page">
    <div class="form-container">
      <div class="form-header">
        <h1>üë§ –î–∞–≤–∞–π –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è</h1>
        <p>–≠—Ç–æ –∑–∞–π–º—ë—Ç 2 –º–∏–Ω—É—Ç—ã ‚Äî –∏ Morphe –ø–æ—Å—Ç—Ä–æ–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–º–µ–Ω–Ω–æ –¥–ª—è —Ç–µ–±—è.</p>
      </div>

      <form id="profileForm">
        <div class="form-group">
          <label for="name">–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
          <input type="text" id="name" name="name" placeholder="–ê–ª–µ–∫—Å–µ–π">
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
            <input type="number" id="age" name="age" min="13" max="100" required>
          </div>

          <div class="form-group">
            <label for="gender">–ü–æ–ª</label>
            <select id="gender" name="gender" required>
              <option value="male">–ú—É–∂—Å–∫–æ–π</option>
              <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
              <option value="other">–î—Ä—É–≥–æ–µ</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="height">–†–æ—Å—Ç (—Å–º)</label>
            <input type="number" id="height" name="height" min="100" max="250" required>
          </div>

          <div class="form-group">
            <label for="weight">–í–µ—Å (–∫–≥)</label>
            <input type="number" id="weight" name="weight" min="30" max="200" step="0.1" required>
          </div>
        </div>

        <div class="form-group">
          <label for="goal">–¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å?</label>
          <select id="goal" name="goal" required>
            <option value="muscle">–ù–∞–±—Ä–∞—Ç—å –º—ã—à—Ü—ã –∏ —Å–∏–ª—É</option>
            <option value="fatloss">–°–Ω–∏–∑–∏—Ç—å % –∂–∏—Ä–∞, –ø–æ–¥—Ç—è–Ω—É—Ç—å—Å—è</option>
            <option value="health">–ó–¥–æ—Ä–æ–≤—å–µ, —ç–Ω–µ—Ä–≥–∏—è, —Ç–æ–Ω—É—Å</option>
          </select>
        </div>

        <div class="form-group">
          <label for="experience">–¢–≤–æ–π –æ–ø—ã—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫?</label>
          <select id="experience" name="experience" required>
            <option value="beginner">–ù–æ–≤–∏—á–æ–∫ (0‚Äì6 –º–µ—Å)</option>
            <option value="intermediate">–°—Ä–µ–¥–Ω–∏–π (6 –º–µ—Å ‚Äì 2 –≥–æ–¥–∞)</option>
            <option value="advanced">–û–ø—ã—Ç–Ω—ã–π (2+ –≥–æ–¥–∞)</option>
          </select>
        </div>

        <div class="form-group">
          <label>–ß—Ç–æ –µ—Å—Ç—å —É —Ç–µ–±—è –¥–æ–º–∞? (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
          <div class="checkbox-grid">
            <label class="checkbox-item">
              <input type="checkbox" name="equipment" value="dumbbells">
              <span>–ì–∞–Ω—Ç–µ–ª–∏</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="equipment" value="bench">
              <span>–°–∫–∞–º—å—è</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="equipment" value="bands">
              <span>–†–µ–∑–∏–Ω–∫–∏</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="equipment" value="bar">
              <span>–®—Ç–∞–Ω–≥</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="equipment" value="none">
              <span>–ù–∏—á–µ–≥–æ ‚Äî —Ç–æ–ª—å–∫–æ –≤–µ—Å —Ç–µ–ª–∞</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>–ï—Å—Ç—å –ª–∏ –±–æ–ª–∏ –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è? (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)</label>
          <div class="checkbox-grid">
            <label class="checkbox-item">
              <input type="checkbox" name="injuries" value="shoulder">
              <span>–ü–ª–µ—á–∏</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="injuries" value="back">
              <span>–°–ø–∏–Ω–∞ / –ø–æ—è—Å–Ω–∏—Ü–∞</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="injuries" value="knee">
              <span>–ö–æ–ª–µ–Ω–∏</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="injuries" value="none">
              <span>–ù–µ—Ç, –≤—Å—ë —Ö–æ—Ä–æ—à–æ</span>
            </label>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="availableDays">–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é –º–æ–∂–µ—à—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è?</label>
            <select id="availableDays" name="availableDays" required>
              <option value="2">2 –¥–Ω—è</option>
              <option value="3">3 –¥–Ω—è</option>
              <option value="4" selected>4 –¥–Ω—è</option>
              <option value="5">5 –¥–Ω–µ–π</option>
              <option value="6">6 –¥–Ω–µ–π</option>
            </select>
          </div>

          <div class="form-group">
            <label for="timePerSession">–°–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –≥–æ—Ç–æ–≤ —É–¥–µ–ª—è—Ç—å –æ–¥–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ?</label>
            <select id="timePerSession" name="timePerSession" required>
              <option value="30">30 –º–∏–Ω—É—Ç</option>
              <option value="45" selected>45 –º–∏–Ω—É—Ç</option>
              <option value="60">60 –º–∏–Ω—É—Ç</option>
              <option value="75">75+ –º–∏–Ω—É—Ç</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="preferredTime">–ö–æ–≥–¥–∞ —Ç–µ–±–µ —É–¥–æ–±–Ω–µ–µ –≤—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è?</label>
          <select id="preferredTime" name="preferredTime" required>
            <option value="morning">–£—Ç—Ä–æ (–¥–æ 12:00)</option>
            <option value="afternoon">–î–µ–Ω—å (12:00‚Äì18:00)</option>
            <option value="evening">–í–µ—á–µ—Ä (–ø–æ—Å–ª–µ 18:00)</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ ‚Üí</button>
          <a href="../index.html" class="btn-secondary">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</a>
        </div>
      </form>
    </div>
  </main>

  <script type="module">
    import { MorpheProfile } from '../modules/profile.js';

    const profile = new MorpheProfile();
    const form = document.getElementById('profileForm');

    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
    function populateForm() {
      for (let key in profile.data) {
        const el = document.getElementById(key) || document.querySelector(`[name="${key}"]`);
        if (!el) continue;

        if (el.type === 'checkbox') {
          // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ
        } else if (el.tagName === 'SELECT' || el.type === 'text' || el.type === 'number') {
          el.value = profile.data[key];
        }
      }

      // –ó–∞–ø–æ–ª–Ω—è–µ–º —á–µ–∫–±–æ–∫—Å—ã –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
      if (profile.data.equipment) {
        document.querySelectorAll('input[name="equipment"]').forEach(cb => {
          cb.checked = profile.data.equipment.includes(cb.value);
        });
      }

      // –ó–∞–ø–æ–ª–Ω—è–µ–º —á–µ–∫–±–æ–∫—Å—ã —Ç—Ä–∞–≤–º
      if (profile.data.injuries) {
        document.querySelectorAll('input[name="injuries"]').forEach(cb => {
          cb.checked = profile.data.injuries.includes(cb.value);
        });
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    populateForm();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const data = {};

      // –û–±—ã—á–Ω—ã–µ –ø–æ–ª—è
      for (let [key, value] of formData.entries()) {
        if (key !== 'equipment' && key !== 'injuries') {
          data[key] = value;
        }
      }

      // –ß–µ–∫–±–æ–∫—Å—ã ‚Äî –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
      data.equipment = formData.getAll('equipment').filter(v => v !== 'none');
      if (data.equipment.length === 0) data.equipment = ['none'];

      // –ß–µ–∫–±–æ–∫—Å—ã ‚Äî —Ç—Ä–∞–≤–º—ã
      data.injuries = formData.getAll('injuries').filter(v => v !== 'none');
      if (data.injuries.length === 0) data.injuries = [];

      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
      profile.updateBatch(data);
      profile.markAsCompleted();

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç
      alert("‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω! Morphe —É–∂–µ —Å—Ç—Ä–æ–∏—Ç —Ç–≤–æ—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É...");
      window.location.href = "../index.html";
    });
  </script>
</body>
</html>