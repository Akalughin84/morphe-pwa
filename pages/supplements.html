<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Morphe ‚Äî –í–∏—Ç–∞–º–∏–Ω—ã</title>
  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet" href="../styles-form.css" />
</head>
<body>
  <header class="page-header">
    <div class="container">
      <a href="../index.html" class="logo-link">
        <div class="logo">Morphe</div>
      </a>

      <!-- –ì–∞–º–±—É—Ä–≥–µ—Ä -->
      <button id="menuToggle" class="menu-toggle" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <nav id="mainNav" class="page-nav">
        <a href="../pages/profile.html" class="nav-link">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
        <a href="../pages/nutrition.html" class="nav-link">üçΩ –ü–∏—Ç–∞–Ω–∏–µ</a>
        <a href="../pages/workouts.html" class="nav-link">üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a>
        <a href="../pages/progress.html" class="nav-link">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</a>
      </nav>
    </div>
  </header>

  <main class="supplements-page">
    <div class="container">
      <h1>üíä –í–∏—Ç–∞–º–∏–Ω—ã –∏ –¥–æ–±–∞–≤–∫–∏</h1>
      <p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö –∏ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ.</p>

      <div id="recommendations"></div>

      <div class="divider"></div>

      <h2>üìö –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</h2>
      <div id="allSupplements"></div>
    </div>
  </main>

  <script type="module">
    import { MorpheProfile } from '../modules/profile.js';
    import { SupplementAdvisor } from '../core/supplementAdvisor.js';

    const profile = new MorpheProfile();
    const recContainer = document.getElementById('recommendations');
    const allContainer = document.getElementById('allSupplements');

    if (!profile.isComplete()) {
      recContainer.innerHTML = `
        <p>‚ùå –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, —Å–Ω–∞—á–∞–ª–∞ <a href="../pages/profile.html">–∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</a>.</p>
      `;
      throw new Error("–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω");
    }

    const advisor = new SupplementAdvisor(profile.data);
    await advisor.load();

    // === –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ===
    const recommendations = advisor.getRecommendations();

    recContainer.innerHTML = `
      <div class="ai-advice-panel">
        <h3>üéØ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –≤–∞–º:</h3>
        ${recommendations.map(s => `
          <div class="supplement-card">
            <h4>${s.name}</h4>
            <p><strong>–î–æ–∑–∏—Ä–æ–≤–∫–∞:</strong> ${s.form}</p>
            <p><strong>–ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏:</strong> ${s.bestFor.join(', ')}</p>
            <p><strong>–ö–æ–≥–¥–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å:</strong> ${s.whenToTake}</p>
            ${s.notes ? `<p><small>üí° ${s.notes}</small></p>` : ''}
            
            <details style="margin-top: 10px;">
              <summary>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π</summary>
              <ul>${s.research.map(r => `<li><small>${r}</small></li>`).join('')}</ul>
            </details>
          </div>
        `).join('')}
      </div>
    `;

    // === –ü–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ===
    allContainer.innerHTML = advisor.getAll().map(s => `
      <div class="supplement-card">
        <h4>${s.name}</h4>
        <p><strong>–§–æ—Ä–º–∞:</strong> ${s.form}</p>
        <p><strong>–ü–æ–∫–∞–∑–∞–Ω–∏—è:</strong> ${s.bestFor.join(', ')}</p>
        <p><strong>–í—Ä–µ–º—è –ø—Ä–∏—ë–º–∞:</strong> ${s.whenToTake}</p>
        ${s.seasonalUse ? `<p><strong>–°–µ–∑–æ–Ω–Ω–æ—Å—Ç—å:</strong> ${s.seasonalUse}</p>` : ''}
        ${s.notes ? `<p><small>üí° ${s.notes}</small></p>` : ''}
        
        <details>
          <summary>–ù–∞—É—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</summary>
          <ul>${s.research.map(r => `<li><small>${r}</small></li>`).join('')}</ul>
        </details>
      </div>
    `).join('');

    // === –ì–∞–º–±—É—Ä–≥–µ—Ä-–º–µ–Ω—é ===
    const menuToggle = document.getElementById('menuToggle');
    const mainNav = document.getElementById('mainNav');

    if (menuToggle && mainNav) {
      menuToggle.addEventListener('click', () => {
        menuToggle.classList.toggle('active');
        mainNav.classList.toggle('active');
      });

      document.querySelectorAll('.page-nav a').forEach(link => {
        link.addEventListener('click', () => {
          menuToggle.classList.remove('active');
          mainNav.classList.remove('active');
        });
      });

      document.addEventListener('click', (e) => {
        if (!mainNav.contains(e.target) && !menuToggle.contains(e.target)) {
          menuToggle.classList.remove('active');
          mainNav.classList.remove('active');
        }
      });
    }
  </script>
</body>
</html>