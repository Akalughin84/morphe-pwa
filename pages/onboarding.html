<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å ‚Äî Morphe</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon-32.png">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f97316">

  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/styles-shared.css">
  <link rel="stylesheet" href="/styles-header.css">
</head>
<body>

  <!-- –ó–∞–≥–ª—É—à–∫–∞ —à–∞–ø–∫–∏ -->
  <div id="header-placeholder"></div>

  <main id="main-content" tabindex="-1">
    <div class="container">
      <div class="onboarding-container">
        <div class="onboarding-progress">
          <div class="progress-bar">
            <div id="onboardingProgress" class="bar-fill" style="width: 0%"></div>
          </div>
          <small id="stepCounter" class="text-tertiary">–®–∞–≥ 1 –∏–∑ 4</small>
        </div>

        <div id="onboardingSlides" class="onboarding-slides">
          <div class="slide active" data-step="1" role="tabpanel" aria-label="–®–∞–≥ 1">
            <div class="slide-icon">üå±</div>
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Morphe</h2>
            <p>–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –≠—Ç–æ –≤–∞—à —Ü–∏—Ñ—Ä–æ–≤–æ–π –¥–≤–æ–π–Ω–∏–∫ ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
            <p><strong>–ù–∏–∫–∞–∫–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫. –ù–∏–∫–∞–∫–æ–π —Ä–µ–∫–ª–∞–º—ã. –¢–æ–ª—å–∫–æ –≤—ã –∏ –≤–∞—à —Ä–æ—Å—Ç.</strong></p>
          </div>

          <div class="slide" data-step="2" role="tabpanel" aria-label="–®–∞–≥ 2">
            <div class="slide-icon">üéØ</div>
            <h2>–í–∞—à–∞ —Ü–µ–ª—å ‚Äî –≤–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è</h2>
            <p>Morphe –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤–∞—Å –≤ –∫–æ–≥–æ-—Ç–æ –¥—Ä—É–≥–æ–≥–æ. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ç–∞—Ç—å –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–µ–π —Å–µ–±—è.</p>
            <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å ‚Äî –∏ –Ω–∞—á–Ω—ë—Ç—Å—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è.</p>
          </div>

          <div class="slide" data-step="3" role="tabpanel" aria-label="–®–∞–≥ 3">
            <div class="slide-icon">üß†</div>
            <h2>–£–º–Ω—ã–π, –Ω–æ –ø—Ä–æ—Å—Ç–æ–π</h2>
            <p>AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞—ë—Ç —Å–æ–≤–µ—Ç—ã ‚Äî –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞.</p>
            <p>–í—ã ‚Äî —Ö–æ–∑—è–∏–Ω —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö.</p>
          </div>

          <div class="slide" data-step="4" role="tabpanel" aria-label="–®–∞–≥ 4">
            <div class="slide-icon">üöÄ</div>
            <h2>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</h2>
            <p>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—ã –ø–æ–ø–∞–¥—ë—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Å–º–æ–∂–µ—Ç–µ:</p>
            <ul>
              <li>–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</li>
              <li>–ù–∞—á–∞—Ç—å –ø–µ—Ä–≤—É—é —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</li>
              <li>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –ø–∏—Ç–∞–Ω–∏—è</li>
            </ul>
          </div>
        </div>

        <div class="onboarding-controls">
          <button id="prevBtn" type="button" class="btn-outline" disabled>‚Üê –ù–∞–∑–∞–¥</button>
          <div class="control-buttons">
            <button id="nextBtn" type="button" class="btn-primary">–î–∞–ª–µ–µ ‚Üí</button>
            <button id="skipBtn" type="button" class="btn-text">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js');
      });
    }
  </script>

  <script type="module">
    import { HeaderController } from '/core/HeaderController.js';
    import { ThemeManager } from '/core/themeManager.js';
    import { OnboardingManager } from '/modules/onboardingManager.js';

    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await HeaderController.loadHeader();
        new ThemeManager();

        const manager = new OnboardingManager();
        const slides = document.querySelectorAll('.slide');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const skipBtn = document.getElementById('skipBtn');
        const progressFill = document.getElementById('onboardingProgress');
        const stepCounter = document.getElementById('stepCounter');

        let currentStep = 0;
        const totalSteps = slides.length;

        function updateUI() {
          // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã
          slides.forEach(slide => {
            slide.classList.remove('active');
            slide.setAttribute('aria-hidden', 'true');
          });

          // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π
          const currentSlide = slides[currentStep];
          currentSlide.classList.add('active');
          currentSlide.setAttribute('aria-hidden', 'false');

          // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
          const progress = ((currentStep + 1) / totalSteps) * 100;
          progressFill.style.width = `${progress}%`;
          stepCounter.textContent = `–®–∞–≥ ${currentStep + 1} –∏–∑ ${totalSteps}`;

          // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
          prevBtn.disabled = currentStep === 0;
          nextBtn.textContent = currentStep === totalSteps - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å ‚Üí' : '–î–∞–ª–µ–µ ‚Üí';
        }

        prevBtn.addEventListener('click', () => {
          if (currentStep > 0) {
            currentStep--;
            updateUI();
          }
        });

        nextBtn.addEventListener('click', () => {
          if (currentStep < totalSteps - 1) {
            currentStep++;
            updateUI();
          } else {
            manager.complete();
            goToMain();
          }
        });

        skipBtn.addEventListener('click', () => {
          if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥?")) {
            manager.complete();
            goToMain();
          }
        });

        function goToMain() {
          window.location.href = '/index.html';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —É–∂–µ –ø—Ä–æ–π–¥–µ–Ω ‚Äî —Å—Ä–∞–∑—É –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        if (!manager.shouldShow()) {
          goToMain();
          return;
        }

        updateUI();

      } catch (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞:', err);
        window.location.href = '/index.html';
      }
    });

    // –ü–æ–¥–≤–∞–ª
    document.addEventListener('DOMContentLoaded', () => {
      import('/core/HeaderController.js')
        .then(m => m.HeaderController.loadFooter())
        .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–≤–∞–ª–∞:', err));
    });
  </script>

  <style>
    .skip-link {
      position: absolute;
      top: -40px;
      left: 10px;
      background: #000;
      color: #fff;
      padding: 8px;
      text-decoration: none;
      z-index: 1000;
      transition: top 0.3s;
    }
    .skip-link:focus {
      top: 10px;
      outline: 2px solid #fff;
    }

    .onboarding-container {
      max-width: 600px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .onboarding-progress {
      margin-bottom: 32px;
      text-align: center;
    }

    .onboarding-slides {
      min-height: 300px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .slide {
      display: none;
      padding: 24px 0;
      text-align: center;
      animation: fadeIn 0.4s ease forwards;
    }

    .slide.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .slide-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      color: var(--accent);
    }

    .onboarding-controls {
      display: flex;
      gap: 12px;
      justify-content: space-between;
      margin-top: 32px;
      align-items: center;
    }

    .control-buttons {
      display: flex;
      gap: 12px;
    }

    @media (max-width: 480px) {
      .onboarding-controls {
        flex-direction: column;
        align-items: stretch;
      }
      .control-buttons {
        flex-direction: column;
      }
      .onboarding-controls button,
      .control-buttons button {
        width: 100%;
      }
    }

    .text-tertiary {
      color: var(--text-tertiary);
    }
  </style>
</body>
</html>