<!-- pages/simple-workouts.html -->
<!-- Version: 2.0.0 -->

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Morphe ‚Äî –ü—Ä–æ—Å—Ç—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</title>
  <link rel="stylesheet" href="../styles.css" />
  <style>
    .simple-workout-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border: 1px solid #e0e0e0;
    }
    
    .simple-exercise {
      padding: 15px;
      background: #f9f9f9;
      border-radius: 10px;
      margin-bottom: 10px;
      border-left: 3px solid #2E7D32;
    }
    
    .simple-timer {
      background: #FF6F00;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 14px;
    }
    
    .timer-display {
      font-weight: bold;
      color: #2E7D32;
      margin-top: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <header class="page-header">
    <div class="container">
      <a href="../index.html" class="logo-link">
        <div class="logo">Morphe</div>
      </a>
      <nav class="page-nav">
        <a href="../index.html" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="profile.html" class="nav-link">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
      </nav>
    </div>
  </header>

  <main class="workouts-page">
    <div class="container">
      <div class="page-header-section">
        <h1>üí™ –¢–≤–æ—è –ø—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h1>
        <p>–†–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</p>
        <button id="regenerateBtn" class="btn-secondary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</button>
      </div>

      <div id="programContainer">
        <div style="text-align: center; padding: 50px;">
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã...</p>
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    console.log("üöÄ –ó–ê–ì–†–£–ó–ö–ê –ü–†–û–°–¢–´–• –¢–†–ï–ù–ò–†–û–í–û–ö v2.0.0");
    
    try {
      // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
      const profileModule = await import('../modules/profile.js');
      const workoutModule = await import('../modules/simpleWorkout.js');
      
      const MorpheProfile = profileModule.MorpheProfile;
      const SimpleWorkoutGenerator = workoutModule.SimpleWorkoutGenerator;
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      const profile = new MorpheProfile();
      const generator = new SimpleWorkoutGenerator();
      
      console.log("üë§ –ü—Ä–æ—Ñ–∏–ª—å:", profile.data);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
      let program = generator.loadProgram();
      if (!program) {
        program = generator.generate(profile.data);
        generator.saveProgram(program);
      }
      
      console.log("üìã –ü—Ä–æ–≥—Ä–∞–º–º–∞:", program);
      renderProgram(program);

      // –†–µ–Ω–¥–µ—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã
      function renderProgram(program) {
        const container = document.getElementById('programContainer');
        container.innerHTML = '';

        for (let dayKey in program) {
          const day = program[dayKey];
          const dayNum = dayKey.replace('day', '');

          const card = document.createElement('div');
          card.className = 'simple-workout-card';
          
          if (day.type === "rest") {
            card.innerHTML = `
              <h3>üìÖ –î–µ–Ω—å ${dayNum}: ${day.name}</h3>
              <p style="color: #666; font-style: italic;">–û—Ç–¥—ã—Ö–∞–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è üí§</p>
            `;
          } else {
            let exercisesHTML = '';
            if (day.exercises && day.exercises.length > 0) {
              exercisesHTML = day.exercises.map(ex => `
                <div class="simple-exercise">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <strong>${ex.name}</strong>
                    <span style="background: #e8f5e9; color: #2E7D32; padding: 3px 8px; border-radius: 12px; font-size: 12px;">
                      ${ex.sets} √ó ${ex.reps}
                    </span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 14px; color: #666;">
                    <span>–í–µ—Å: ${ex.recommendedWeight || 0} –∫–≥</span>
                    <span>–û—Ç–¥—ã—Ö: ${ex.rest} —Å–µ–∫</span>
                  </div>
                  <button class="simple-timer" onclick="startTimer('${ex.id}', ${ex.rest})" id="timer-${ex.id}">
                    ‚è±Ô∏è –¢–∞–π–º–µ—Ä (${ex.rest}—Å)
                  </button>
                  <div class="timer-display" id="display-${ex.id}" style="display: none;"></div>
                </div>
              `).join('');
            } else {
              exercisesHTML = '<p style="color: #999;">–ù–µ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</p>';
            }

            card.innerHTML = `
              <h3>üìÖ –î–µ–Ω—å ${dayNum}: ${day.name}</h3>
              <div style="margin-top: 15px;">
                ${exercisesHTML}
              </div>
              <div style="margin-top: 20px; text-align: center;">
                <button class="btn-primary" onclick="completeDay('${dayKey}')">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–Ω—å</button>
              </div>
            `;
          }
          
          container.appendChild(card);
        }
      }

      // –¢–∞–π–º–µ—Ä
      let activeTimer = null;
      let timerInterval = null;

      window.startTimer = function(exerciseId, seconds) {
        // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω - –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
        if (activeTimer === exerciseId && timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
          activeTimer = null;
          document.getElementById(`timer-${exerciseId}`).textContent = `‚è±Ô∏è –¢–∞–π–º–µ—Ä (${seconds}—Å)`;
          document.getElementById(`display-${exerciseId}`).style.display = 'none';
          return;
        }

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
        if (timerInterval) {
          clearInterval(timerInterval);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
        activeTimer = exerciseId;
        let timeLeft = seconds;
        const timerBtn = document.getElementById(`timer-${exerciseId}`);
        const display = document.getElementById(`display-${exerciseId}`);
        
        timerBtn.textContent = `‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (${timeLeft}—Å)`;
        display.textContent = `‚è≥ ${formatTime(timeLeft)}`;
        display.style.display = 'block';

        timerInterval = setInterval(() => {
          timeLeft--;
          display.textContent = `‚è≥ ${formatTime(timeLeft)}`;
          
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            timerInterval = null;
            activeTimer = null;
            
            // –ó–≤—É–∫ –∏ –≤–∏–±—Ä–∞—Ü–∏—è
            if (navigator.vibrate) {
              navigator.vibrate([500]);
            }
            
            display.textContent = '‚è∞ –í—Ä–µ–º—è!';
            display.style.color = '#FF6F00';
            timerBtn.textContent = `‚è±Ô∏è –¢–∞–π–º–µ—Ä (${seconds}—Å)`;
            
            setTimeout(() => {
              display.style.display = 'none';
              display.style.color = '#2E7D32';
            }, 3000);
          }
        }, 1000);
      };

      // –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏
      function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      }

      // –ó–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–Ω—å
      window.completeDay = function(dayKey) {
        alert(`üéâ –î–µ–Ω—å ${dayKey.replace('day', '')} –∑–∞–≤–µ—Ä—à—ë–Ω! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!`);
      };

      // –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
      document.getElementById('regenerateBtn').addEventListener('click', () => {
        const newProgram = generator.generate(profile.data);
        generator.saveProgram(newProgram);
        renderProgram(newProgram);
        alert("‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!");
      });

    } catch (error) {
      console.error("üí• –û–®–ò–ë–ö–ê:", error);
      document.getElementById('programContainer').innerHTML = `
        <div style="text-align: center; padding: 50px; color: red;">
          <h3>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
          <p>${error.message}</p>
          <button onclick="location.reload()" class="btn-primary" style="margin-top: 20px;">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
        </div>
      `;
    }
  </script>
</body>
</html>