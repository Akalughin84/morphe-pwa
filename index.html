<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Morphe ‚Äî –¢–≤–æ—è —Ñ–æ—Ä–º–∞ ‚Äî —Ç–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è</title>

  <!-- SEO & Open Graph -->
  <meta name="description" content="–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —É–º–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ, –Ω–∞—É—á–Ω—ã–µ –¥–æ–±–∞–≤–∫–∏. –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω.">
  <meta property="og:title" content="Morphe ‚Äî –¢–≤–æ—è —Ñ–æ—Ä–º–∞ ‚Äî —Ç–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è">
  <meta property="og:description" content="–°—Ç–∞–Ω—å –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–µ–π —Å–µ–±—è —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º AI-—Ç—Ä–µ–Ω–µ—Ä–æ–º.">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Morphe ‚Äî –¢–≤–æ—è —Ñ–æ—Ä–º–∞ ‚Äî —Ç–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è">
  <meta name="twitter:description" content="–°—Ç–∞–Ω—å –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–µ–π —Å–µ–±—è —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º AI-—Ç—Ä–µ–Ω–µ—Ä–æ–º.">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/icon-16.png">
  <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
  <link rel="manifest" href="/manifest.json">

  <!-- Theme color ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ –æ—Ä–∞–Ω–∂–µ–≤—ã–π -->
  <meta name="theme-color" content="#f97316">

  <!-- –®—Ä–∏—Ñ—Ç—ã -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@700;800&display=swap" media="print" onload="this.media='all'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
  </noscript>

  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/styles-shared.css">
  <link rel="stylesheet" href="/styles-header.css">
  <link rel="stylesheet" href="/styles-home.css">
  <link rel="stylesheet" href="/styles-achievements.css">
</head>
<body>

  <div id="header-placeholder"></div>

  <main id="main-content">
    <!-- –ì–µ—Ä–æ–π -->
    <section class="hero">
      <div class="container">
        <div class="hero-wrapper">
          <div class="hero-content">
            <div class="hero-badge">–°–æ–∑–¥–∞–Ω–æ –ê–ª–µ–∫—Å–µ–µ–º –ö–∞–ª—É–≥–∏–Ω—ã–º</div>
            <h1>–¢–≤–æ—è —Ñ–æ—Ä–º–∞ ‚Äî <span>—Ç–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è</span></h1>
            <p class="hero-subtitle">
              Morphe –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–±—è –≤ –∫–æ–≥–æ-—Ç–æ –¥—Ä—É–≥–æ–≥–æ.<br>
              –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç —Ç–µ–±–µ —Å—Ç–∞—Ç—å <strong>–ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–µ–π —Å–µ–±—è</strong>.
            </p>
            <a href="/pages/workouts.html" class="btn-primary cta">–ù–∞—á–∞—Ç—å –º–æ—é —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é ‚Üí</a>

            <div class="user-summary" id="current-stats">
              –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
    <section class="dashboard-section">
      <div class="container">
        <h2>üìä –¢–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥</h2>
        <p id="dashboardStatus">–°–æ–±–∏—Ä–∞—é –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –¥–∞—Ç—å —Ç–µ–±–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã...</p>
        <div id="analyticsSummary" style="display: none;">
          <h3 id="analyticsTitle">‚Äî</h3>
          <p id="analyticsText">‚Äî</p>
          <div class="user-summary" style="margin-top: 1.25rem; padding: 1rem;">
            <div class="stat-row">
              <span>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ:</span>
              <strong id="workoutCount">‚Äî</strong>
            </div>
            <div class="stat-row">
              <span>–°—Ä–µ–¥–Ω—è—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</span>
              <strong id="avgIntensity">‚Äî</strong>
            </div>
            <div class="stat-row">
              <span>–ë–∞–ª–∞–Ω—Å –ë–ñ–£:</span>
              <span id="macroBalance" class="pill pill-ok">–≤ –Ω–æ—Ä–º–µ</span>
            </div>
          </div>
        </div>

        <!-- –ù–û–í–´–ô –ë–õ–û–ö: –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ 3 –Ω–µ–¥–µ–ª–∏ -->
        <div id="progressPreview" style="display: none; margin-top: 1.5rem;">
          <h3>üìà –¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ 3 –Ω–µ–¥–µ–ª–∏</h3>
          <div class="progress-preview-chart" id="weightChart"></div>
          <p id="progressForecast" class="info-text"></p>
        </div>
      </div>
    </section>

    <!-- –ü–æ—á–µ–º—É Morphe? -->
    <section class="why-section">
      <div class="container">
        <h2>–ü–æ—á–µ–º—É <span>Morphe —Ä–∞–±–æ—Ç–∞–µ—Ç</span></h2>
        <p class="section-intro">
          –ü–æ—Ç–æ–º—É —á—Ç–æ –º—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ ‚Äî –º—ã <strong>–ø–æ–Ω–∏–º–∞–µ–º —Ç–µ–±—è</strong> –∏ –ø–æ–º–æ–≥–∞–µ–º —Ä–∞—Å—Ç–∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ.
        </p>
        <div class="why-grid">
          <div class="why-card">
            <div class="icon">üß†</div>
            <h3>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç, –∞ –Ω–µ —à–∞–±–ª–æ–Ω—ã</h3>
            <p>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –ø–∏—Ç–∞–Ω–∏–µ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ —Ç–≤–æ—ë —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ü–µ–ª–∏ ‚Äî –∫–∞–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä.</p>
          </div>
          <div class="why-card">
            <div class="icon">ü•ó</div>
            <h3>–ü–∏—Ç–∞–Ω–∏–µ –±–µ–∑ –¥–æ–≥–º</h3>
            <p>–ù–µ—Ç –∂—ë—Å—Ç–∫–∏—Ö –¥–∏–µ—Ç. –¢–æ–ª—å–∫–æ –≥–∏–±–∫–∏–π —Ä–∞—Å—á—ë—Ç –ë–ñ–£ –∏ —Å–æ–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å –≤ —Ç–≤–æ—é –∂–∏–∑–Ω—å.</p>
          </div>
          <div class="why-card">
            <div class="icon">üî¨</div>
            <h3>–ù–∞—É–∫–∞ –≤–º–µ—Å—Ç–æ –º–∏—Ñ–æ–≤</h3>
            <p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–æ–±–∞–≤–∫–∞–º –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö ‚Äî –±–µ–∑ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –∏ –ø—É—Å—Ç—ã—Ö –æ–±–µ—â–∞–Ω–∏–π.</p>
          </div>
          <div class="why-card">
            <div class="icon">üìä</div>
            <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–µ–Ω</h3>
            <p>–¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç—Ä–µ–Ω–∏—Ä—É–µ—à—å—Å—è ‚Äî —Ç—ã –≤–∏–¥–∏—à—å, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è —Ç–µ–ª–æ, —ç–Ω–µ—Ä–≥–∏—è –∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- –ê–≤—Ç–æ—Ä -->
    <section class="author-section">
      <div class="container">
        <div class="author-content">
          <div class="author-photo">
            <div class="photo-placeholder">–ê–ö</div>
          </div>
          <div class="author-text">
            <h2>–°–æ–∑–¥–∞–Ω–æ <span>—Å —É–≤–∞–∂–µ–Ω–∏–µ–º</span></h2>
            <p>–Ø ‚Äî –ê–ª–µ–∫—Å–µ–π –ö–∞–ª—É–≥–∏–Ω. –Ø –Ω–µ –æ–±–µ—â–∞—é —á—É–¥–µ—Å. –Ø –≤–µ—Ä—é, —á—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π —Ä–æ—Å—Ç ‚Äî —ç—Ç–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –≤—ã–±–æ—Ä.</p>
            <p>Morphe ‚Äî –º–æ–π —Å–ø–æ—Å–æ–± –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –±—ã—Ç—å –∑–¥–æ—Ä–æ–≤—ã–º, —Å–∏–ª—å–Ω—ã–º –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–º ‚Äî –±–µ–∑ —à—É–º–∞, –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ª–∂–∏.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π CTA -->
    <section class="final-cta">
      <div class="container">
        <h2>–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å?</h2>
        <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ —Ç–µ–º, –∫—Ç–æ –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–æ—Å—Ç ‚Äî –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã, –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ª–∂–∏.</p>
        <a href="/pages/profile.html" class="btn-primary">–ù–∞—á–∞—Ç—å —Å–µ–π—á–∞—Å</a>
      </div>
    </section>
  </main>

  <!-- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –£–î–ê–õ–ï–ù–ê -->

  <div id="footer-placeholder"></div>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('‚úÖ SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', reg.scope))
          .catch(err => console.log('‚ùå –û—à–∏–±–∫–∞ SW:', err));
      });
    }
  </script>

  <!-- –ú–æ–¥—É–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —è–¥—Ä–∞ -->
  <script type="module">
    import { HeaderController } from './core/HeaderController.js';
    import { HomeDashboard } from './core/HomeDashboard.js';
    import { AnalyticsEngine } from './core/analytics.js';
    import { OnboardingManager } from './modules/onboardingManager.js';

    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const onboarding = new OnboardingManager();
        if (onboarding.shouldShow()) {
          window.location.href = '/pages/onboarding.html';
          return;
        }

        await HeaderController.loadHeader();
        await HeaderController.loadFooter();

        // === 1. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —Å —Ü–µ–ª—è–º–∏ –∏ –ë–ñ–£ ===
        const currentStatsEl = document.getElementById('current-stats');
        const dashboardStatus = document.getElementById('dashboardStatus');
        const analyticsSummary = document.getElementById('analyticsSummary');
        const analyticsTitle = document.getElementById('analyticsTitle');
        const analyticsText = document.getElementById('analyticsText');
        const progressPreview = document.getElementById('progressPreview');
        const weightChart = document.getElementById('weightChart');
        const progressForecast = document.getElementById('progressForecast');

        try {
          // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
          const { UserService } = await import('./services/userService.js');
          const user = UserService.getProfile();
          if (!user || !user.data) {
            throw new Error("–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω");
          }
          const profile = user.data;

          // –†–∞—Å—á—ë—Ç –ë–ñ–£
          const { NutritionEngine } = await import('./core/nutritionEngine.js');
          const engine = new NutritionEngine(user);
          const macros = engine.calculateMacros();
          const advice = engine.getAdvice();

          // –¶–µ–ª–µ–≤–æ–π –≤–µ—Å ‚Äî –±–µ—Ä—ë–º –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
          let targetWeight = profile.targetWeight;
          let goalText = '';

          if (profile.goal === 'maintain') {
            goalText = '–¶–µ–ª—å: –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã';
          } else if (targetWeight) {
            goalText = `–¶–µ–ª—å: ${targetWeight} –∫–≥ (${profile.goal === 'gain' ? '–Ω–∞–±–æ—Ä –º–∞—Å—Å—ã' : '–ø–æ—Ö—É–¥–µ–Ω–∏–µ'})`;
          } else {
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª —Ü–µ–ª—å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑—É–º–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç
            targetWeight = profile.goal === 'gain' 
              ? Math.round(profile.weight + 7) 
              : Math.max(50, Math.round(profile.weight - 5));
            goalText = `–¶–µ–ª—å: ${targetWeight} –∫–≥ (${profile.goal === 'gain' ? '–Ω–∞–±–æ—Ä –º–∞—Å—Å—ã' : '–ø–æ—Ö—É–¥–µ–Ω–∏–µ'})`;
          }

          // –ü—Ä–æ–≥–Ω–æ–∑ —Å—Ä–æ–∫–∞ (0.25‚Äì0.5 –∫–≥/–Ω–µ–¥–µ–ª—é ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ç–µ–º–ø)
          let forecastText = '';
          if (profile.goal !== 'maintain' && targetWeight) {
            const diff = Math.abs(targetWeight - profile.weight);
            const safeRate = profile.goal === 'lose' ? 0.4 : 0.3; // –∫–≥/–Ω–µ–¥–µ–ª—é
            const weeks = Math.max(1, Math.ceil(diff / safeRate));
            forecastText = `–ü—Ä–æ–≥–Ω–æ–∑: —Ü–µ–ª—å –∑–∞ ~${weeks} –Ω–µ–¥–µ–ª—å –ø—Ä–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Ç–µ–º–ø–µ.`;
          }

          // –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è
          currentStatsEl.innerHTML = `
            <div class="stat-row">
              <strong>‚öñÔ∏è ${profile.weight} –∫–≥</strong>
              <small>–†–æ—Å—Ç ${profile.height} —Å–º ‚Ä¢ ${profile.age} –ª–µ—Ç</small>
            </div>
            <div class="stat-row">
              <strong>üéØ ${goalText}</strong>
            </div>
            <div class="stat-row">
              <strong>ü•ó ${macros.calories} –∫–∫–∞–ª</strong>
              <small>–ë: ${macros.protein}–≥ ‚Ä¢ –ñ: ${macros.fats}–≥ ‚Ä¢ –£: ${macros.carbs}–≥</small>
            </div>
            ${forecastText ? `<div class="stat-row"><small>${forecastText}</small></div>` : ''}
          `;

          // === 2. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ===

          // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
          const { WorkoutTracker } = await import('./modules/workoutTracker.js');
          const workoutTracker = new WorkoutTracker();
          const weeklyWorkouts = workoutTracker.getWeeklyCount();
          document.getElementById('workoutCount').textContent = weeklyWorkouts;

          // –°—Ä–µ–¥–Ω—è—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å (—É–ø—Ä–æ—â—ë–Ω–Ω–æ: –Ω–∞ –æ—Å–Ω–æ–≤–µ RPE –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫)
          const allWorkouts = workoutTracker.getAll();
          const recentWorkouts = allWorkouts.slice(0, 3); // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3
          const avgRPE = recentWorkouts.length > 0
            ? (recentWorkouts.reduce((sum, w) => sum + (w.rpe || 7), 0) / recentWorkouts.length).toFixed(1)
            : '‚Äî';
          document.getElementById('avgIntensity').textContent = avgRPE + (avgRPE !== '‚Äî' ? '/10' : '');

          // –ë–ñ–£: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –∏ —Ñ–∞–∫—Ç–∞
          const { NutritionTracker } = await import('./modules/nutritionTracker.js');
          const nutritionTracker = new NutritionTracker();
          const todayMacros = nutritionTracker.getTotalMacrosToday();
          const plan = UserService.getNutritionPlan?.();

          let macroStatus = '–≤ –Ω–æ—Ä–º–µ';
          let macroClass = 'pill-ok';

          if (plan?.macros) {
            const proteinPct = todayMacros.protein / plan.macros.protein;
            const caloriesPct = todayMacros.calories / plan.calories;

            if (proteinPct < 0.7 || caloriesPct < 0.7) {
              macroStatus = '–Ω–∏–∑–∫–æ–µ';
              macroClass = 'pill-bad';
            } else if (proteinPct > 1.3 || caloriesPct > 1.3) {
              macroStatus = '–≤—ã—Å–æ–∫–æ–µ';
              macroClass = 'pill-warning';
            }
          }

          const macroBalanceEl = document.getElementById('macroBalance');
          macroBalanceEl.textContent = macroStatus;
          macroBalanceEl.className = `pill ${macroClass}`;

          // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
          const analytics = new AnalyticsEngine();
          const summary = analytics.getSummary();
          analyticsTitle.textContent = summary.title || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
          analyticsText.textContent = summary.summary || '–ù–∞—á–Ω–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å.';
          dashboardStatus.style.display = 'none';
          analyticsSummary.style.display = 'block';

          // === 2. –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ 21 –¥–µ–Ω—å ===
          const { ProgressTracker } = await import('./modules/progressTracker.js');
          const tracker = new ProgressTracker();
          const recent = tracker.getSince(21);

          if (recent.length >= 2) {
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ
            recent.sort((a, b) => new Date(a.date) - new Date(b.date));
            const weights = recent.map(r => r.weight);
            const min = Math.min(...weights);
            const max = Math.max(...weights);
            const range = max - min || 1;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º "–≥—Ä–∞—Ñ–∏–∫" –∏–∑ —Å–∏–º–≤–æ–ª–æ–≤
            const chart = weights.map(w => {
              const height = Math.round(((w - min) / range) * 5); // 0‚Äì5 —É—Ä–æ–≤–Ω–µ–π
              return '‚ñà'.repeat(height || 1);
            }).join(' ');

            weightChart.textContent = chart;
            weightChart.style.fontFamily = 'monospace';
            weightChart.style.fontSize = '1.2rem';
            weightChart.style.lineHeight = 1;

            // –ü—Ä–æ–≥–Ω–æ–∑
            const first = recent[0];
            const last = recent[recent.length - 1];
            const change = last.weight - first.weight;
            if (profile.goal === 'lose' && change < -0.5) {
              progressForecast.textContent = '‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í–µ—Å —Å–Ω–∏–∂–∞–µ—Ç—Å—è ‚Äî –≤—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏.';
              progressForecast.className = 'success-text';
            } else if (profile.goal === 'gain' && change > 0.5) {
              progressForecast.textContent = '‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –µ—Å—Ç—å! –ú–∞—Å—Å–∞ —Ä–∞—Å—Ç—ë—Ç ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ.';
              progressForecast.className = 'success-text';
            } else if (Math.abs(change) < 0.3) {
              progressForecast.textContent = 'üìä –ü–æ–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –î–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ.';
              progressForecast.className = 'info-text';
            } else {
              progressForecast.textContent = '‚ö†Ô∏è –ü—Ä–æ–≥—Ä–µ—Å—Å –µ—Å—Ç—å, –Ω–æ —Ç–µ–º–ø –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å.';
              progressForecast.className = 'warning-text';
            }
            progressPreview.style.display = 'block';
          }

        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', err);
          currentStatsEl.innerHTML = `
            <p><a href="/pages/profile.html" class="link-primary">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</a>, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤–∞—à–∏ —Ü–µ–ª–∏ –∏ –ë–ñ–£.</p>
          `;
          dashboardStatus.textContent = "–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!";
          dashboardStatus.className = "info-text";
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è "–ü–æ—á–µ–º—É Morphe?"
        const whySection = document.querySelector('.why-section');
        const whyGrid = document.querySelector('.why-grid');
        if (whySection && whyGrid) {
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                whyGrid.classList.add('visible');
                observer.unobserve(entry.target);
              }
            });
          }, { threshold: 0.1 });
          observer.observe(whySection);
        }

      } catch (err) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ index.html:', err);
        const statusEl = document.getElementById('dashboardStatus');
        if (statusEl) {
          statusEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.";
          statusEl.className = 'error-text';
        }
      }
    });
  </script>

  <!-- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
  <style>
    body {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      margin: 0;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    .why-card {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .why-grid.visible .why-card {
      opacity: 1;
      transform: translateY(0);
    }
    .why-card:nth-child(1) { transition-delay: 0.1s; }
    .why-card:nth-child(2) { transition-delay: 0.2s; }
    .why-card:nth-child(3) { transition-delay: 0.3s; }
    .why-card:nth-child(4) { transition-delay: 0.4s; }

    /* –ù–û–í–´–ô –°–¢–ò–õ–¨ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
    .progress-preview-chart {
      background: var(--bg-surface-alt);
      padding: 1rem;
      border-radius: 8px;
      font-family: monospace;
      white-space: pre;
      overflow-x: auto;
      margin: 1rem 0;
    }
  </style>
</body>
</html>